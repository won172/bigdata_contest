# 위기 신호 탐색 EDA 계획

## 1. 분석 목표와 데이터 개요
- 목적: `ENCODED_MCT`별로 매출·고객·채널 지표가 급격히 악화되는 조합을 확인해 가맹점 위기 신호를 도출한다.
- 소스: `df_merged.csv` (행 86,590개, 열 40개)로 2023-01~2024-12 사이 성동구 요식업/소매 가맹점 4,185개를 월 단위로 결합한 데이터.
- 특징: 업종 대분류 13종, 월별 고유 가맹점 수는 중앙값 3,602개 수준으로 기간 전반에 고르게 분포.

## 2. 데이터 품질 점검 및 정제 로드맵
1. **기본 진단**: `info()`, `describe()`로 타입과 분포 확인, `isna().sum()`으로 결측 규모 산출.
2. **결측/이상 처리**  
   - 날짜형: `TA_YM`을 `datetime64`로 변환 후 `기준년월` 컬럼 생성, `ARE_D`는 개점일 정보 그대로 유지.  
   - 범주형 구간: `MCT_OPE_MS_CN`, `RC_M1_*`, `APV_CE_RAT` 등은 `rank`, `bucket`을 분리(예: `3_25-50%` → 순위 3, 구간 25-50%). 
   - 수치형 더미값: `DLV_SAA_RAT`와 일부 경쟁 지표는 `-999999.9`가 25~66% 등장하므로 `NaN`으로 치환 후 분석 전 처리율 확인.  
   - 결측 비율: `MCT_ME_D` 97%, `APV_CE_RAT` 7.7%, 채널 비율(`RC_M1_SHC_*`) 8.5% → 변수별 목적에 맞게 대체 전략을 설정.
   - 결측 대체 전략:  
     1) `배달이용금액_비율`은 -999999.9 치환 후 가맹점 단위 선형 보간, 전 기간 결측인 가맹점은 0으로 간주하고 `배달데이터_미집계_flag`를 남겨 채널 부재 여부를 유지한다(실측값이 존재하는 가맹점은 약 39%).  
     2) `승인취소비율_구간`은 가맹점별 forward/back fill → 업종·기준월 중앙값 → 전체 중앙값 순으로 보정해 순위를 보존하고, 정수(1~6)로 반올림 후 원래 라벨을 재생성한다.  
     3) `12개월_동일상권_경쟁강도`는 동일 방식의 시계열 보간 후 업종·기준월 중앙값과 전체 중앙값으로 대체해 데이터가 비는 1,047개 가맹점도 비교 가능하게 한다.  
     4) `RC_*` 채널 비율 3종은 가맹점 시계열 보간 뒤 업종·기준월 중앙값으로 메워 기간별 추세와 업종 특성을 유지한다.  
     5) 결측률 80% 이상(`MCT_ME_D`, `MCT_BRD_NUM`)은 설명력이 낮아 분석 대상에서 제거한다.
3. **衍生 지표 설계**: 월별 증감률, 이동평균, 분위수 편차(동종업종 대비) 등 위험 스코어 계산 대비 컬럼 생성.

## 3. 1차 탐색 분석 시나리오
- **거래·매출 트렌드**: `M1_SME_RY_SAA_RAT`, `M12_SME_*_PCE_RT` 중심으로 월별 박스플롯과 IQR을 통해 순위 급락 구간 포착. 업종별·업력별 분포 비교.
- **고객 구조**: 남/녀, 연령대 비중(`M12_MAL_*`, `M12_FME_*`) 합계가 100을 이루는지 검증 후, 급격한 구성 변화가 위기 선행인지 시각화(히트맵, 레이더 차트).
- **채널 의존도**: 배달 비율(`DLV_SAA_RAT`), 신한카드 특화 채널 비중(`RC_M1_SHC_*`)의 결측을 처리하고, 업력(`MCT_OPE_MS_CN`)과 교차해 신규 가맹점의 채널 전략을 파악.
- **이상 징후**: 승인취소(`APV_CE_RAT`), 재방문율(`MCT_UE_CLN_REU_RAT`), 신규고객율(`MCT_UE_CLN_NEW_RAT`)의 분포와 상호 관계(산점도, 2D KDE)로 위험 클러스터 탐색.

## 4. 위기 신호 가설 및 검증 계획
- **순위 급락형**: 최근 3개월 `M12_SME_BZN_SAA_PCE_RT`가 20p 이상 상승(백분위 하락)을 보이는 가맹점을 특정하고, 동일 기간 취소율·배달비율 변화를 대조.
- **고객 이탈형**: 재방문율이 하위 10%로 떨어지면서 신규고객율도 함께 하락하는 조합을 위험 그룹으로 정의.
- **채널 미스매치형**: 업력 상위 구간에서 배달 비중이 급증하거나 반대로 급감하는 경우, 경쟁강도(`M12_SME_RY_ME_MCT_RAT`)와 함께 모니터링.
- **특정 업종 리스크**: 업종별 평균 대비 1.5 IQR 이상 악화된 가맹점을 플래그하여 시각적으로 비교.

## 5. 후속 과제
1. 월·가맹점 레벨에서 이상치를 제거/대체한 후 스무딩, 지수이동평균을 적용한 위험 지수 설계.
2. 가설 검증용 라벨(예: 순위 하위 10% 지속 3개월 이상)을 정의하고 지도/비지도 모델링 준비.
3. 시각화 자동화: 주요 지표에 대한 `seaborn` 페이싯, Plotly 대시보드 초안으로 정기 모니터링 체계 구축.
